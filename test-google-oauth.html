<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Google OAuth - Real Estate App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .section h2 {
            color: #667eea;
            font-size: 18px;
            margin-bottom: 15px;
        }

        .btn {
            display: inline-block;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            margin: 5px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-google {
            background: white;
            color: #333;
            border: 1px solid #ddd;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-google:hover {
            background: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .btn-google img {
            width: 20px;
            height: 20px;
        }

        .info {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .success {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .error {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .code {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 10px 0;
        }

        .status {
            display: none;
            margin-top: 20px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .user-info {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            border: 2px solid #4caf50;
        }

        .user-info img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-bottom: 15px;
        }

        .user-info h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .user-info p {
            color: #666;
            margin: 5px 0;
        }

        .endpoints {
            list-style: none;
        }

        .endpoints li {
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
            font-family: monospace;
            font-size: 13px;
        }

        .endpoints li strong {
            color: #667eea;
            display: inline-block;
            width: 80px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê Test Google OAuth</h1>
        <p class="subtitle">Website B·∫•t ƒê·ªông S·∫£n - Authentication Testing</p>

        <div class="section">
            <h2>üìã Th√¥ng Tin C·∫•u H√¨nh</h2>
            <div class="info">
                <strong>Backend URL:</strong> <span id="backendUrl">http://localhost:5000</span><br>
                <strong>Frontend URL:</strong> <span id="frontendUrl">http://localhost:3000</span>
            </div>
        </div>

        <div class="section">
            <h2>üß™ Test Methods</h2>
            
            <h3 style="margin: 15px 0 10px 0; color: #333;">Method 1: Server-side OAuth Flow</h3>
            <button class="btn btn-google" onclick="testServerSideOAuth()">
                <img src="https://www.google.com/favicon.ico" alt="Google">
                Test Server-side OAuth
            </button>
            <p style="margin-top: 10px; color: #666; font-size: 14px;">
                Redirect ƒë·∫øn backend, backend x·ª≠ l√Ω OAuth v·ªõi Google
            </p>

            <h3 style="margin: 15px 0 10px 0; color: #333;">Method 2: Client-side Token Verify</h3>
            <button class="btn btn-primary" onclick="testClientSideVerify()">
                Test Token Verify API
            </button>
            <p style="margin-top: 10px; color: #666; font-size: 14px;">
                G·ª≠i Google token ƒë·∫øn backend ƒë·ªÉ verify
            </p>

            <h3 style="margin: 15px 0 10px 0; color: #333;">Test Frontend Integration</h3>
            <a href="http://localhost:3000/login" class="btn btn-primary" target="_blank">
                M·ªü Login Page
            </a>
            <p style="margin-top: 10px; color: #666; font-size: 14px;">
                Test Google Login button tr√™n trang Login th·ª±c t·∫ø
            </p>
        </div>

        <div class="section">
            <h2>üîó API Endpoints</h2>
            <ul class="endpoints">
                <li><strong>GET</strong> /api/auth/google</li>
                <li><strong>GET</strong> /api/auth/google/callback</li>
                <li><strong>POST</strong> /api/auth/google/verify</li>
                <li><strong>POST</strong> /api/auth/login</li>
                <li><strong>POST</strong> /api/auth/register</li>
                <li><strong>GET</strong> /api/auth/me</li>
            </ul>
        </div>

        <div class="status" id="status"></div>
        <div class="user-info" id="userInfo"></div>

        <div class="section">
            <h2>üìù Checklist</h2>
            <div style="padding: 10px;">
                <label style="display: block; margin: 10px 0;">
                    <input type="checkbox" id="check1"> Google Cloud Project ƒë√£ t·∫°o
                </label>
                <label style="display: block; margin: 10px 0;">
                    <input type="checkbox" id="check2"> OAuth consent screen ƒë√£ c·∫•u h√¨nh
                </label>
                <label style="display: block; margin: 10px 0;">
                    <input type="checkbox" id="check3"> Client ID v√† Secret ƒë√£ c√≥
                </label>
                <label style="display: block; margin: 10px 0;">
                    <input type="checkbox" id="check4"> File .env ƒë√£ c·∫≠p nh·∫≠t
                </label>
                <label style="display: block; margin: 10px 0;">
                    <input type="checkbox" id="check5"> Dependencies ƒë√£ c√†i ƒë·∫∑t
                </label>
                <label style="display: block; margin: 10px 0;">
                    <input type="checkbox" id="check6"> Server ƒëang ch·∫°y (port 5000)
                </label>
                <label style="display: block; margin: 10px 0;">
                    <input type="checkbox" id="check7"> Client ƒëang ch·∫°y (port 3000)
                </label>
            </div>
        </div>
    </div>

    <script>
        const BACKEND_URL = 'http://localhost:5000';
        const FRONTEND_URL = 'http://localhost:3000';

        function showStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.style.display = 'block';
            status.className = type;
            status.innerHTML = message;
        }

        function testServerSideOAuth() {
            showStatus('Redirecting to Google OAuth...', 'info');
            setTimeout(() => {
                window.location.href = `${BACKEND_URL}/api/auth/google`;
            }, 1000);
        }

        async function testClientSideVerify() {
            showStatus('<div class="loading"></div> Testing token verify endpoint...', 'info');
            
            try {
                // Test v·ªõi mock token (s·∫Ω fail nh∆∞ng ki·ªÉm tra endpoint c√≥ ho·∫°t ƒë·ªông kh√¥ng)
                const response = await fetch(`${BACKEND_URL}/api/auth/google/verify`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        credential: 'mock-token-for-testing'
                    })
                });

                const data = await response.json();
                
                if (response.status === 500 || data.message) {
                    showStatus(`
                        <strong>‚úÖ Endpoint ho·∫°t ƒë·ªông!</strong><br>
                        Status: ${response.status}<br>
                        Message: ${data.message || 'Token verify endpoint is working'}<br>
                        <br>
                        <em>Note: L·ªói n√†y l√† b√¨nh th∆∞·ªùng v√¨ ƒëang test v·ªõi mock token.</em><br>
                        <em>ƒê·ªÉ test th·ª±c t·∫ø, s·ª≠ d·ª•ng Google Login button tr√™n trang Login.</em>
                    `, 'success');
                } else {
                    showStatus(`Response: ${JSON.stringify(data, null, 2)}`, 'info');
                }
            } catch (error) {
                showStatus(`
                    <strong>‚ùå L·ªói k·∫øt n·ªëi!</strong><br>
                    ${error.message}<br>
                    <br>
                    <strong>Ki·ªÉm tra:</strong><br>
                    1. Server c√≥ ƒëang ch·∫°y kh√¥ng? (npm run dev trong th∆∞ m·ª•c server)<br>
                    2. Port 5000 c√≥ b·ªã chi·∫øm kh√¥ng?<br>
                    3. CORS c√≥ ƒë∆∞·ª£c c·∫•u h√¨nh ƒë√∫ng kh√¥ng?
                `, 'error');
            }
        }

        // Check URL parameters for OAuth callback
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');
        const error = urlParams.get('error');

        if (token) {
            showStatus('<div class="loading"></div> ƒêang l·∫•y th√¥ng tin user...', 'info');
            
            fetch(`${BACKEND_URL}/api/auth/me`, {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            })
            .then(res => res.json())
            .then(data => {
                if (data.success && data.data.user) {
                    const user = data.data.user;
                    document.getElementById('userInfo').style.display = 'block';
                    document.getElementById('userInfo').innerHTML = `
                        ${user.avatar ? `<img src="${user.avatar}" alt="${user.name}">` : ''}
                        <h3>‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng!</h3>
                        <p><strong>T√™n:</strong> ${user.name}</p>
                        <p><strong>Email:</strong> ${user.email}</p>
                        <p><strong>Role:</strong> ${user.role}</p>
                        <p><strong>Provider:</strong> ${user.authProvider || 'local'}</p>
                        <div class="code">Token: ${token.substring(0, 50)}...</div>
                    `;
                    showStatus('', 'success');
                }
            })
            .catch(err => {
                showStatus(`L·ªói: ${err.message}`, 'error');
            });
        }

        if (error) {
            showStatus(`‚ùå OAuth Error: ${error}`, 'error');
        }

        // Auto-check server status
        window.addEventListener('load', async () => {
            try {
                const response = await fetch(`${BACKEND_URL}/api`);
                if (response.ok) {
                    document.getElementById('check6').checked = true;
                }
            } catch (error) {
                console.log('Server not running');
            }
        });
    </script>
</body>
</html>
